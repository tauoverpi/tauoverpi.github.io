<html><head><meta charset="UTF-8"><link rel="stylesheet" href="../css/skeleton.css"/><link rel="stylesheet" href="../css/site.css"/><link href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono&display=swap" rel="stylesheet"></head><body><h1 id="interfaces-generics-and-object-algebras">Interfaces, Generics, and Object-Algebras</h1>
<div class="container">
<h2 id="a-simple-algebra">A Simple Algebra</h2>
<h3 id="interface">Interface</h3>
<p>Interfaces in C# allow for the definition of a common communication protocol for objects involved without having to know more than the object implementing it. We start by defining an interface <code>IAlg</code> taking a generic type parameter <code>A</code> which the implementations will provide.</p>
<div class="sourceCode" id="algebra-interface"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="algebra-interface-1" title="1"><span class="kw">public</span> <span class="kw">interface</span> IAlg&lt;A&gt;</a>
<a class="sourceLine" id="algebra-interface-2" title="2">{</a>
<a class="sourceLine" id="algebra-interface-3" title="3">    A <span class="fu">Lit</span>(<span class="dt">int</span> x);</a>
<a class="sourceLine" id="algebra-interface-4" title="4">    A <span class="fu">Add</span>(A x, A y);</a>
<a class="sourceLine" id="algebra-interface-5" title="5">}</a></code></pre></div>
<p>The language consists only of expressions of constants where <code>Lit</code> introduces a constant and addition with the <code>Add</code> constructor. Given this we can construct a set of programs in out meta language (C#) which construct valid programs in object language <code>IAlg</code>.</p>
<p>The first constructs a program for calculating the sum of the expression <span class="math inline">3 + (4 + 5)</span>.</p>
<div class="sourceCode" id="algebra-meta"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="algebra-meta-1" title="1"><span class="kw">static</span> A ESum&lt;A&gt;(IAlg&lt;A&gt; o) =&gt;</a>
<a class="sourceLine" id="algebra-meta-2" title="2">    o.<span class="fu">Add</span>(o.<span class="fu">Lit</span>(<span class="dv">3</span>), o.<span class="fu">Add</span>(o.<span class="fu">Lit</span>(<span class="dv">4</span>), o.<span class="fu">Lit</span>(<span class="dv">5</span>)));</a></code></pre></div>
<p>While the second constructs the sum of the expression multiplied by two. However, the language doesn’t currently support multiplication thus we must make do with the sum of the expression evaluated twice.</p>
<div class="sourceCode" id="algebra-meta"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="algebra-meta-1" title="1"><span class="kw">static</span> A ESum2&lt;A&gt;(IAlg&lt;A&gt; o) =&gt; o.<span class="fu">Add</span>(<span class="fu">ESum</span>(o), <span class="fu">ESum</span>(o));</a></code></pre></div>
<p>Notice that at this point in the program we still don’t know the concrete type of <code>A</code> so we’re unable to operate on it with anything other than the operators defined within our language. This isn’t a negative! By restricting what we can do we gain in reasoning about what out program can do. Now of course an implementation may diverge from our goals yet that’s completely up to them.</p>
<h3 id="implementation">Implementation</h3>
<p>Starting with an implementation for <code>int</code> we see that the translation is pretty straight forward with <code>Lit</code> being the identity function and <code>Add</code> making use of C#’s native <code>+</code> operator.</p>
<div class="sourceCode" id="algebra-int-implementation"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="algebra-int-implementation-1" title="1"><span class="kw">public</span> <span class="kw">class</span> IntAlg : IAlg&lt;<span class="dt">int</span>&gt;</a>
<a class="sourceLine" id="algebra-int-implementation-2" title="2">{</a>
<a class="sourceLine" id="algebra-int-implementation-3" title="3">    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">Lit</span>(<span class="dt">int</span> x) =&gt; x;</a>
<a class="sourceLine" id="algebra-int-implementation-4" title="4">    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">Add</span>(<span class="dt">int</span> x, <span class="dt">int</span> y) =&gt; x + y;</a>
<a class="sourceLine" id="algebra-int-implementation-5" title="5">}</a></code></pre></div>
<p>The implementation for printing expressions isn’t any more spectacular.</p>
<div class="sourceCode" id="algebra-string-implementation"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="algebra-string-implementation-1" title="1"><span class="kw">public</span> <span class="kw">class</span> StrAlg : IAlg&lt;<span class="dt">string</span>&gt;</a>
<a class="sourceLine" id="algebra-string-implementation-2" title="2">{</a>
<a class="sourceLine" id="algebra-string-implementation-3" title="3">    <span class="kw">public</span> <span class="dt">string</span> <span class="fu">Lit</span>(<span class="dt">int</span> x) =&gt; x.<span class="fu">ToString</span>();</a>
<a class="sourceLine" id="algebra-string-implementation-4" title="4">    <span class="kw">public</span> <span class="dt">string</span> <span class="fu">Add</span>(<span class="dt">string</span> x, <span class="dt">string</span> y) =&gt; $<span class="st">&quot;({x} + {y})&quot;</span>;</a>
<a class="sourceLine" id="algebra-string-implementation-5" title="5">}</a></code></pre></div>
<h3 id="main">Main</h3>
<div class="sourceCode" id="algebra-main"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="algebra-main-1" title="1"><span class="kw">public</span> <span class="kw">class</span> Program</a>
<a class="sourceLine" id="algebra-main-2" title="2">{</a>
<a class="sourceLine" id="algebra-main-3" title="3">    &lt;&lt;algebra-meta&gt;&gt;</a>
<a class="sourceLine" id="algebra-main-4" title="4">    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] _)</a>
<a class="sourceLine" id="algebra-main-5" title="5">    {</a>
<a class="sourceLine" id="algebra-main-6" title="6">        Console.<span class="fu">WriteLine</span>(<span class="fu">ESum</span>(<span class="kw">new</span> <span class="fu">IntAlg</span>()));</a>
<a class="sourceLine" id="algebra-main-7" title="7">        Console.<span class="fu">WriteLine</span>(<span class="fu">ESum</span>(<span class="kw">new</span> <span class="fu">StrAlg</span>()));</a>
<a class="sourceLine" id="algebra-main-8" title="8">        Console.<span class="fu">WriteLine</span>(<span class="fu">ESum2</span>(<span class="kw">new</span> <span class="fu">IntAlg</span>()));</a>
<a class="sourceLine" id="algebra-main-9" title="9">        Console.<span class="fu">WriteLine</span>(<span class="fu">ESum2</span>(<span class="kw">new</span> <span class="fu">StrAlg</span>()));</a>
<a class="sourceLine" id="algebra-main-10" title="10">    }</a>
<a class="sourceLine" id="algebra-main-11" title="11">}</a></code></pre></div>
<p>Finally we lay out the program fragments in order.</p>
<div class="sourceCode" id="cb1" data-file="src/csharp/InterfacesGenericsAndObjectAlgebras/Algebra.cs"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">using</span> System;</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">namespace</span> Algebra</a>
<a class="sourceLine" id="cb1-4" title="4">{</a>
<a class="sourceLine" id="cb1-5" title="5">    &lt;&lt;algebra-<span class="kw">interface</span>&gt;&gt;</a>
<a class="sourceLine" id="cb1-6" title="6">    &lt;&lt;algebra-<span class="dt">int</span>-implementation&gt;&gt;</a>
<a class="sourceLine" id="cb1-7" title="7">    &lt;&lt;algebra-<span class="dt">string</span>-implementation&gt;&gt;</a>
<a class="sourceLine" id="cb1-8" title="8">    &lt;&lt;algebra-main&gt;&gt;</a>
<a class="sourceLine" id="cb1-9" title="9">}</a></code></pre></div>
<h3 id="conclusion">Conclusion</h3>
<p>The full source can be found <a href="../src/csharp/InterfacesGenericsAndObjectAlgebras/Algebra.cs">here</a>.</p>
<h2 id="an-extensible-interpreter">An Extensible Interpreter</h2>
<div class="sourceCode" id="interpreter-interface"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="interpreter-interface-1" title="1"><span class="kw">public</span> <span class="kw">interface</span> IEval&lt;A&gt; : IAlg&lt;A&gt;</a>
<a class="sourceLine" id="interpreter-interface-2" title="2">{</a>
<a class="sourceLine" id="interpreter-interface-3" title="3">    A <span class="fu">Var</span>(<span class="dt">string</span> name);</a>
<a class="sourceLine" id="interpreter-interface-4" title="4">    A <span class="fu">Mul</span>(A x, A y);</a>
<a class="sourceLine" id="interpreter-interface-5" title="5">}</a></code></pre></div>
<h3 id="implementation-1">Implementation</h3>
<div class="sourceCode" id="interpreter-int-implementation"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="interpreter-int-implementation-1" title="1"><span class="kw">public</span> <span class="kw">class</span> IntEval: IEval&lt;<span class="dt">int</span>&gt;</a>
<a class="sourceLine" id="interpreter-int-implementation-2" title="2">{</a>
<a class="sourceLine" id="interpreter-int-implementation-3" title="3">    <span class="kw">private</span> Dictionary&lt;<span class="dt">string</span>, <span class="dt">int</span>&gt; env;</a>
<a class="sourceLine" id="interpreter-int-implementation-4" title="4">    <span class="kw">public</span> <span class="fu">IntEval</span>(Dictionary&lt;<span class="dt">string</span>, <span class="dt">int</span>&gt; dict)</a>
<a class="sourceLine" id="interpreter-int-implementation-5" title="5">    {</a>
<a class="sourceLine" id="interpreter-int-implementation-6" title="6">        env = dict;</a>
<a class="sourceLine" id="interpreter-int-implementation-7" title="7">    }</a>
<a class="sourceLine" id="interpreter-int-implementation-8" title="8"></a>
<a class="sourceLine" id="interpreter-int-implementation-9" title="9">    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">Lit</span>(<span class="dt">int</span> x) =&gt; x;</a>
<a class="sourceLine" id="interpreter-int-implementation-10" title="10">    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">Add</span>(<span class="dt">int</span> x, <span class="dt">int</span> y) =&gt; x + y;</a>
<a class="sourceLine" id="interpreter-int-implementation-11" title="11">    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">Mul</span>(<span class="dt">int</span> x, <span class="dt">int</span> y) =&gt; x * y;</a>
<a class="sourceLine" id="interpreter-int-implementation-12" title="12">    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">Var</span>(<span class="dt">string</span> name) =&gt; env[name];</a>
<a class="sourceLine" id="interpreter-int-implementation-13" title="13">}</a></code></pre></div>
<div class="sourceCode" id="interpreter-pretty-implementation"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="interpreter-pretty-implementation-1" title="1"><span class="kw">public</span> <span class="kw">class</span> PrettyEval: IEval&lt;Func&lt;<span class="dt">int</span>, <span class="dt">string</span>&gt;&gt;</a>
<a class="sourceLine" id="interpreter-pretty-implementation-2" title="2">{</a></code></pre></div>
<p>For convenience we abstract over wrapping parenthesis around the expression to lower the noise in the following definitions.</p>
<div class="sourceCode" id="interpreter-pretty-implementation"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="interpreter-pretty-implementation-1" title="1">    <span class="kw">private</span> <span class="fu">paren</span>(<span class="dt">bool</span> x, <span class="dt">string</span> s) =&gt; x? $<span class="st">&quot;({s})&quot;</span> : s;</a></code></pre></div>
<p>Literals ignore the current nesting level and print directly as-is.</p>
<div class="sourceCode" id="interpreter-pretty-implementation"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="interpreter-pretty-implementation-1" title="1">    <span class="kw">public</span> Func&lt;<span class="dt">int</span>, <span class="dt">string</span>&gt; <span class="fu">Lit</span>(<span class="dt">int</span> x) =&gt; _ =&gt; x.<span class="fu">ToString</span>();</a></code></pre></div>
<p>Since multiplication is more tightly binding than addition we might need to wrap the expression in parenthesis when within an expression involving multiplication.</p>
<div class="sourceCode" id="interpreter-pretty-implementation"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="interpreter-pretty-implementation-1" title="1">    <span class="kw">public</span> Func&lt;<span class="dt">int</span>, <span class="dt">string</span>&gt;</a>
<a class="sourceLine" id="interpreter-pretty-implementation-2" title="2">        <span class="fu">Add</span>(Func&lt;<span class="dt">int</span>, <span class="dt">string</span>&gt; x, Func&lt;<span class="dt">int</span>, <span class="dt">string</span>&gt; y) =&gt;</a>
<a class="sourceLine" id="interpreter-pretty-implementation-3" title="3">            i =&gt; <span class="fu">paren</span>(i &lt; <span class="dv">0</span>, $<span class="st">&quot;{x(0)} + {y(0)}&quot;</span>);</a></code></pre></div>
<p>Multiplication itself doesn’t require any parenthesis since it’s the most tightly binding expression within our language.</p>
<div class="sourceCode" id="interpreter-pretty-implementation"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="interpreter-pretty-implementation-1" title="1">    <span class="kw">public</span> Func&lt;<span class="dt">int</span>, <span class="dt">string</span>&gt;</a>
<a class="sourceLine" id="interpreter-pretty-implementation-2" title="2">        <span class="fu">Mul</span>(Func&lt;<span class="dt">int</span>, <span class="dt">string</span>&gt; x, Func&lt;<span class="dt">int</span>, <span class="dt">string</span>&gt; y) =&gt;</a>
<a class="sourceLine" id="interpreter-pretty-implementation-3" title="3">            _ =&gt; $<span class="st">&quot;{x(1)} * {y(1)}&quot;</span>;</a></code></pre></div>
<div class="sourceCode" id="interpreter-pretty-implementation"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="interpreter-pretty-implementation-1" title="1">    <span class="kw">public</span> Func&lt;<span class="dt">int</span>, <span class="dt">string</span>&gt; <span class="fu">Var</span>(<span class="dt">string</span> name) =&gt; name;</a>
<a class="sourceLine" id="interpreter-pretty-implementation-2" title="2">}</a></code></pre></div>
<h2 id="a-scripting-language">A Scripting Language</h2>
<h3 id="interface-1">Interface</h3>
<div class="sourceCode" id="script-interface"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="script-interface-1" title="1"><span class="kw">public</span> <span class="kw">interface</span> IScript&lt;E,S&gt;</a>
<a class="sourceLine" id="script-interface-2" title="2">{</a>
<a class="sourceLine" id="script-interface-3" title="3">    E <span class="fu">Lit</span>(<span class="dt">int</span> x);</a>
<a class="sourceLine" id="script-interface-4" title="4">    E <span class="fu">Add</span>(E x, E y);</a>
<a class="sourceLine" id="script-interface-5" title="5"></a>
<a class="sourceLine" id="script-interface-6" title="6">    E <span class="fu">Assign</span>(<span class="dt">string</span> name, E x);</a>
<a class="sourceLine" id="script-interface-7" title="7">    E <span class="fu">Ref</span>(stirng name);</a>
<a class="sourceLine" id="script-interface-8" title="8"></a>
<a class="sourceLine" id="script-interface-9" title="9">    E <span class="fu">Eq</span>(E x, E y);</a>
<a class="sourceLine" id="script-interface-10" title="10">    E <span class="fu">Lt</span>(E x, E y);</a>
<a class="sourceLine" id="script-interface-11" title="11">    E <span class="fu">Not</span>(E x);</a>
<a class="sourceLine" id="script-interface-12" title="12">    E <span class="fu">And</span>(E x, E y);</a>
<a class="sourceLine" id="script-interface-13" title="13"></a>
<a class="sourceLine" id="script-interface-14" title="14">    S <span class="fu">Print</span>(E x);</a>
<a class="sourceLine" id="script-interface-15" title="15">    S <span class="fu">While</span>(S cond, S loop);</a>
<a class="sourceLine" id="script-interface-16" title="16">    S <span class="fu">If</span>(S cond, S cons, S alt);</a>
<a class="sourceLine" id="script-interface-17" title="17">}</a></code></pre></div>
</div>
<footer><div>Copyright (c) 2019 Simon A. Nielsen Knights</div><div></div></footer></body></html>