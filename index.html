<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Tau’s Articles</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { font-weight: bold; } /* Alert */
code span.an { font-style: italic; } /* Annotation */
code span.cf { font-weight: bold; } /* ControlFlow */
code span.co { font-style: italic; } /* Comment */
code span.cv { font-style: italic; } /* CommentVar */
code span.do { font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.er { font-weight: bold; } /* Error */
code span.in { font-style: italic; } /* Information */
code span.kw { font-weight: bold; } /* Keyword */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.wa { font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="tufte.css" />
  <link rel="stylesheet" href="custom.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Tau’s Articles</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#the-setup"><span class="toc-section-number">1</span> The setup</a></li>
<li><a href="#trying-out-elm"><span class="toc-section-number">2</span> Trying out Elm</a><ul>
<li><a href="#building-a-resource-browser"><span class="toc-section-number">2.1</span> Building a resource browser</a><ul>
<li><a href="#the-model"><span class="toc-section-number">2.1.1</span> The Model</a></li>
<li><a href="#update"><span class="toc-section-number">2.1.2</span> Update</a></li>
<li><a href="#view"><span class="toc-section-number">2.1.3</span> View</a></li>
<li><a href="#main"><span class="toc-section-number">2.1.4</span> Main</a></li>
</ul></li>
</ul></li>
<li><a href="#zig-on-the-web"><span class="toc-section-number">3</span> Zig on the web</a><ul>
<li><a href="#build-script-for-webassembly"><span class="toc-section-number">3.1</span> Build script for WebAssembly</a></li>
<li><a href="#no-really-on-the-web"><span class="toc-section-number">3.2</span> No really, on the web</a></li>
</ul></li>
</ul>
</nav>
<section id="the-setup" class="level1">
<h1><span class="header-section-number">1</span> The setup</h1>
<p>Everything is built by a single Makefile invoking language specific build-systems. The file is extended throughout the document with instructions for each listed project in their respective section.</p>
<pre class="make" data-file="Makefile"><code>&lt;&lt;makefile-pandoc-filters&gt;&gt;
&lt;&lt;makefile-pandoc-options&gt;&gt;
&lt;&lt;makefile-projects&gt;&gt;
&lt;&lt;makefile-html&gt;&gt;</code></pre>
<p>Filters are the heart of building the article with increasing support for citation, side notes, and even embedded graphs!</p>
<pre id="makefile-pandoc-filters" class="make"><code>FILTER := --filter pandoc-crossref
FILTER += --filter pandoc-sidenote
FILTER += --filter pandoc-filter-graphviz
FILTER += --filter pandoc-citeproc</code></pre>
<pre id="makefile-pandoc-options" class="make"><code>OPTIONS := --standalone
OPTIONS += --table-of-contents
OPTIONS += --number-sections
OPTIONS += --reference-links
OPTIONS += --csl ieee.csl
OPTIONS += --metadata-file=metadata.yaml
OPTIONS += --highlight-style monochrome

HTMLOPTIONS := --section-divs
HTMLOPTIONS += --css tufte.css
HTMLOPTIONS += --css custom.css

PDFOPTIONS := --template=handout.tex</code></pre>
<pre id="makefile-projects" class="make"><code>PROJECTS := scripts/resbrowser.js</code></pre>
<pre id="makefile-html" class="make"><code>.PHONY: all
all:: index.html
index.html: ${PROJECTS} article.md Makefile metadata.yaml
    pandoc ${OPTIONS} ${HTMLOPTIONS} ${FILTER} article.md -o index.html

#index.pdf: article.md Makefile metadata.yaml
#   pandoc ${OPTIONS} ${PDFOPTIONS} ${FILTER} article.md -o index.pdf
&lt;&lt;resource-browser-makefile&gt;&gt;</code></pre>
<p>There’s also custom CSS which is again extended throughout the document.</p>
<div class="sourceCode" id="cb2" data-file="custom.css"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb2-1"><a href="#cb2-1"></a>&lt;&lt;custom-css<span class="op">&gt;&gt;</span></span></code></pre></div>
</section>
<section id="trying-out-elm" class="level1">
<h1><span class="header-section-number">2</span> Trying out Elm</h1>
<p>Entry level: beginner</p>
<p>There are a lot of programming languages out there with flashy features and meta programming capabilities embedding the whole language within itself. This isn’t about those languages, this is about Elm.</p>
<p>Elm is a language I’ve avoided for a while due to a number of reasons:</p>
<ol type="1">
<li>It’s a front-end language which I tend not to need as most projects reside outside of a browser.</li>
<li>It doesn’t have type-classes and thus I assumed I’d need to write the same code for several different types over and over again.</li>
<li>An endless pursuit of suckless<span class="citation" data-cites="catvh">[1]</span> qualities for software since complex software is the enemy of correctness.</li>
</ol>
<p>Despite those I eventually decided Elm would be the language for a future project.</p>
<section id="building-a-resource-browser" class="level2">
<h2><span class="header-section-number">2.1</span> Building a resource browser</h2>
<p>Over the years I’ve stumbled over a number of interesting articles which I’ve kept links to in various formats. Now it’s time to make the list searchable and on the web rather than the odd chat history or markdown file.</p>
<p>The “Resource Browser” consists of just four sections of code with not the best of code until the intended audience of one can update it with a better data structure and algorithm.</p>
<div class="sourceCode" id="cb3" data-file="projects/elm/resbrowser/src/ResourceBrowser.elm"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="cb3-1"><a href="#cb3-1"></a><span class="op">&lt;&lt;</span><span class="fu">resbrowser</span><span class="op">-</span><span class="fu">main</span><span class="op">&gt;&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="op">&lt;&lt;</span><span class="fu">resbrowser</span><span class="op">-</span><span class="fu">model</span><span class="op">&gt;&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="op">&lt;&lt;</span><span class="fu">resbrowser</span><span class="op">-</span><span class="fu">update</span><span class="op">&gt;&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="op">&lt;&lt;</span><span class="fu">resbrowser</span><span class="op">-</span><span class="fu">view</span><span class="op">&gt;&gt;</span></span></code></pre></div>
<section id="the-model" class="level3">
<h3><span class="header-section-number">2.1.1</span> The Model</h3>
<p>First we define the model with a given order to sort the results in. This is all the state we need for this application as we’re only tracking what the user wants to find.</p>
<div class="sourceCode" id="resbrowser-model"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="resbrowser-model-1"><a href="#resbrowser-model-1"></a><span class="kw">type</span> <span class="kw">alias</span> <span class="dt">Model</span> <span class="op">=</span> <span class="dt">Order</span></span></code></pre></div>
<p>The <code>Order</code> is dependent on the search field or the tags depending on which the user decides to use and the initial model sets this to empty indicating there’s no current search.</p>
<div class="sourceCode" id="resbrowser-model"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="resbrowser-model-1"><a href="#resbrowser-model-1"></a><span class="kw">type</span> <span class="dt">Order</span></span>
<span id="resbrowser-model-2"><a href="#resbrowser-model-2"></a>  <span class="op">=</span> <span class="dt">TagName</span> <span class="dt">String</span></span>
<span id="resbrowser-model-3"><a href="#resbrowser-model-3"></a>  <span class="op">|</span> <span class="dt">Name</span> <span class="dt">String</span></span>
<span id="resbrowser-model-4"><a href="#resbrowser-model-4"></a></span>
<span id="resbrowser-model-5"><a href="#resbrowser-model-5"></a><span class="fu">init</span> : <span class="dt">Model</span></span>
<span id="resbrowser-model-6"><a href="#resbrowser-model-6"></a><span class="fu">init</span> <span class="op">=</span> <span class="dt">Name</span> <span class="st">&quot;&quot;</span></span></code></pre></div>
<p>This concludes the model definition.</p>
</section>
<section id="update" class="level3">
<h3><span class="header-section-number">2.1.2</span> Update</h3>
<p>Whenever the user types in the input box we’ll get a pre-defined event. In this case we only care of the order they wish to sort and filter by so the update consists of just setting the new order.</p>
<div class="sourceCode" id="resbrowser-update"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="resbrowser-update-1"><a href="#resbrowser-update-1"></a><span class="kw">type</span> <span class="dt">Msg</span></span>
<span id="resbrowser-update-2"><a href="#resbrowser-update-2"></a>  <span class="op">=</span> <span class="dt">SortBy</span> <span class="dt">Order</span></span>
<span id="resbrowser-update-3"><a href="#resbrowser-update-3"></a></span>
<span id="resbrowser-update-4"><a href="#resbrowser-update-4"></a><span class="fu">update</span> : <span class="dt">Msg</span> <span class="op">-&gt;</span> <span class="dt">Model</span> <span class="op">-&gt;</span> <span class="dt">Model</span></span>
<span id="resbrowser-update-5"><a href="#resbrowser-update-5"></a><span class="fu">update</span> <span class="fu">msg</span> <span class="fu">_</span> <span class="op">=</span></span>
<span id="resbrowser-update-6"><a href="#resbrowser-update-6"></a>  <span class="cf">case</span> <span class="fu">msg</span> <span class="cf">of</span></span>
<span id="resbrowser-update-7"><a href="#resbrowser-update-7"></a>    <span class="dt">SortBy</span> <span class="fu">order</span> <span class="op">-&gt;</span> <span class="fu">order</span></span></code></pre></div>
<p>And that concludes updating… not much to see here.</p>
</section>
<section id="view" class="level3">
<h3><span class="header-section-number">2.1.3</span> View</h3>
<div class="sourceCode" id="resbrowser-view"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="resbrowser-view-1"><a href="#resbrowser-view-1"></a><span class="fu">view</span> : <span class="dt">Model</span> <span class="op">-&gt;</span> <span class="dt">Html</span> <span class="dt">Msg</span></span>
<span id="resbrowser-view-2"><a href="#resbrowser-view-2"></a><span class="fu">view</span> <span class="fu">order</span> <span class="op">=</span></span>
<span id="resbrowser-view-3"><a href="#resbrowser-view-3"></a>  <span class="fu">div</span> []</span>
<span id="resbrowser-view-4"><a href="#resbrowser-view-4"></a>    [ <span class="fu">div</span> []</span>
<span id="resbrowser-view-5"><a href="#resbrowser-view-5"></a>      [ <span class="fu">text</span> <span class="st">&quot;search for resources: &quot;</span></span>
<span id="resbrowser-view-6"><a href="#resbrowser-view-6"></a>      <span class="op">,</span> <span class="fu">input</span> [ <span class="fu">onInput</span> (<span class="dt">SortBy</span> <span class="op">&lt;&lt;</span> <span class="dt">Name</span>) ] []</span>
<span id="resbrowser-view-7"><a href="#resbrowser-view-7"></a>      <span class="op">,</span> <span class="fu">text</span> <span class="st">&quot; or by &quot;</span></span>
<span id="resbrowser-view-8"><a href="#resbrowser-view-8"></a>      <span class="op">,</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> <span class="fu">tagButton</span> <span class="dt">Resources</span><span class="op">.</span><span class="fu">tags</span></span>
<span id="resbrowser-view-9"><a href="#resbrowser-view-9"></a>        <span class="op">|&gt;</span> <span class="fu">div</span> [ <span class="fu">class</span> <span class="st">&quot;resource-tag-search&quot;</span> ]</span>
<span id="resbrowser-view-10"><a href="#resbrowser-view-10"></a>        <span class="op">|&gt;</span> \<span class="fu">x</span> <span class="op">-&gt;</span> <span class="fu">span</span> [ <span class="fu">class</span> <span class="st">&quot;resource-tag-container&quot;</span> ] [ <span class="fu">text</span> <span class="st">&quot;[tag]&quot;</span><span class="op">,</span> <span class="fu">x</span>]</span>
<span id="resbrowser-view-11"><a href="#resbrowser-view-11"></a>      ]</span>
<span id="resbrowser-view-12"><a href="#resbrowser-view-12"></a>    <span class="op">,</span> <span class="fu">filterAndSortBy</span> <span class="fu">order</span></span>
<span id="resbrowser-view-13"><a href="#resbrowser-view-13"></a>      <span class="op">|&gt;</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> <span class="fu">viewResource</span></span>
<span id="resbrowser-view-14"><a href="#resbrowser-view-14"></a>      <span class="op">|&gt;</span> <span class="fu">div</span> []</span>
<span id="resbrowser-view-15"><a href="#resbrowser-view-15"></a>    ]</span></code></pre></div>
<p>For each resource the title and tags are drawn on the same line with a custom style.</p>
<div class="sourceCode" id="resbrowser-view"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="resbrowser-view-1"><a href="#resbrowser-view-1"></a><span class="fu">viewResource</span> : <span class="dt">Resource</span> <span class="op">-&gt;</span> <span class="dt">Html</span> <span class="dt">Msg</span></span>
<span id="resbrowser-view-2"><a href="#resbrowser-view-2"></a><span class="fu">viewResource</span> {<span class="fu">title</span><span class="op">,</span> <span class="fu">url</span><span class="op">,</span> <span class="fu">tags</span>} <span class="op">=</span></span>
<span id="resbrowser-view-3"><a href="#resbrowser-view-3"></a>  <span class="kw">let</span></span>
<span id="resbrowser-view-4"><a href="#resbrowser-view-4"></a>    <span class="fu">res</span> <span class="op">=</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> <span class="fu">tagButton</span> <span class="fu">tags</span></span>
<span id="resbrowser-view-5"><a href="#resbrowser-view-5"></a>  <span class="kw">in</span></span>
<span id="resbrowser-view-6"><a href="#resbrowser-view-6"></a>    <span class="fu">div</span> [ <span class="fu">class</span> <span class="st">&quot;resource&quot;</span> ]</span>
<span id="resbrowser-view-7"><a href="#resbrowser-view-7"></a>      [ <span class="fu">div</span> [ <span class="fu">class</span> <span class="st">&quot;resource-link&quot;</span> ] [ <span class="fu">a</span> [ <span class="fu">href</span> <span class="fu">url</span> ] [ <span class="fu">text</span> <span class="fu">title</span> ] ]</span>
<span id="resbrowser-view-8"><a href="#resbrowser-view-8"></a>      <span class="op">,</span> <span class="fu">div</span> [ <span class="fu">class</span> <span class="st">&quot;resource-tags&quot;</span> ] <span class="fu">res</span></span>
<span id="resbrowser-view-9"><a href="#resbrowser-view-9"></a>      ]</span></code></pre></div>
<p>Tags really only send a <code>SortBy</code> message when clicked to update the view.</p>
<div class="sourceCode" id="resbrowser-view"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="resbrowser-view-1"><a href="#resbrowser-view-1"></a><span class="fu">tagButton</span> <span class="fu">x</span> <span class="op">=</span></span>
<span id="resbrowser-view-2"><a href="#resbrowser-view-2"></a>  <span class="fu">button</span></span>
<span id="resbrowser-view-3"><a href="#resbrowser-view-3"></a>    [ <span class="fu">onClick</span> (<span class="dt">SortBy</span> (<span class="dt">TagName</span> <span class="fu">x</span>))<span class="op">,</span> <span class="fu">class</span> <span class="st">&quot;resource-tag&quot;</span> ]</span>
<span id="resbrowser-view-4"><a href="#resbrowser-view-4"></a>    [<span class="fu">text</span> (<span class="st">&quot;#&quot;</span> <span class="op">++</span> <span class="fu">x</span>)]</span></code></pre></div>
<p>But they look a bit plain without a bit of style so lets add some.</p>
<div class="sourceCode" id="custom-css"><pre class="sourceCode css"><code class="sourceCode css"><span id="custom-css-1"><a href="#custom-css-1"></a><span class="fu">.resource-tag</span> {</span>
<span id="custom-css-2"><a href="#custom-css-2"></a>  <span class="kw">margin-top</span>: <span class="dv">2</span><span class="dt">px</span><span class="op">;</span></span>
<span id="custom-css-3"><a href="#custom-css-3"></a>  <span class="kw">margin-bottom</span>: <span class="dv">2</span><span class="dt">px</span><span class="op">;</span></span>
<span id="custom-css-4"><a href="#custom-css-4"></a>  <span class="kw">margin-left</span>: <span class="dv">2</span><span class="dt">px</span><span class="op">;</span></span>
<span id="custom-css-5"><a href="#custom-css-5"></a>  <span class="kw">margin-right</span>: <span class="dv">2</span><span class="dt">px</span><span class="op">;</span></span>
<span id="custom-css-6"><a href="#custom-css-6"></a>  <span class="kw">border-style</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="custom-css-7"><a href="#custom-css-7"></a>  <span class="kw">box-shadow</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">2</span><span class="dt">px</span> <span class="dv">4</span><span class="dt">px</span> <span class="cn">#ccccc8</span><span class="op">;</span></span>
<span id="custom-css-8"><a href="#custom-css-8"></a>  <span class="kw">background-color</span>: <span class="cn">#fffff8</span><span class="op">;</span></span>
<span id="custom-css-9"><a href="#custom-css-9"></a>}</span>
<span id="custom-css-10"><a href="#custom-css-10"></a></span>
<span id="custom-css-11"><a href="#custom-css-11"></a><span class="fu">.resource-tag-container</span> {</span>
<span id="custom-css-12"><a href="#custom-css-12"></a>  <span class="kw">position</span>: <span class="dv">relative</span><span class="op">;</span></span>
<span id="custom-css-13"><a href="#custom-css-13"></a>}</span>
<span id="custom-css-14"><a href="#custom-css-14"></a></span>
<span id="custom-css-15"><a href="#custom-css-15"></a><span class="fu">.resource-tag-search</span> {</span>
<span id="custom-css-16"><a href="#custom-css-16"></a>  <span class="kw">display</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="custom-css-17"><a href="#custom-css-17"></a>  <span class="kw">position</span>: <span class="dv">absolute</span><span class="op">;</span></span>
<span id="custom-css-18"><a href="#custom-css-18"></a>  <span class="kw">width</span>: <span class="dv">600</span><span class="dt">px</span><span class="op">;</span></span>
<span id="custom-css-19"><a href="#custom-css-19"></a>  <span class="kw">background</span>: <span class="cn">#fffff8</span><span class="op">;</span></span>
<span id="custom-css-20"><a href="#custom-css-20"></a>  x: <span class="dv">+10</span><span class="dt">%</span><span class="op">;</span></span>
<span id="custom-css-21"><a href="#custom-css-21"></a>}</span>
<span id="custom-css-22"><a href="#custom-css-22"></a></span>
<span id="custom-css-23"><a href="#custom-css-23"></a><span class="fu">.resource-tag-container</span><span class="in">:hover</span> <span class="fu">.resource-tag-search</span> {</span>
<span id="custom-css-24"><a href="#custom-css-24"></a>  <span class="kw">display</span>: <span class="dv">block</span><span class="op">;</span></span>
<span id="custom-css-25"><a href="#custom-css-25"></a>}</span>
<span id="custom-css-26"><a href="#custom-css-26"></a></span>
<span id="custom-css-27"><a href="#custom-css-27"></a><span class="fu">.resource-tags</span> {</span>
<span id="custom-css-28"><a href="#custom-css-28"></a>  <span class="kw">display</span>: flex<span class="op">;</span></span>
<span id="custom-css-29"><a href="#custom-css-29"></a>  <span class="kw">justify-content</span>: flex-end<span class="op">;</span></span>
<span id="custom-css-30"><a href="#custom-css-30"></a>}</span>
<span id="custom-css-31"><a href="#custom-css-31"></a></span>
<span id="custom-css-32"><a href="#custom-css-32"></a><span class="fu">.resource</span> {</span>
<span id="custom-css-33"><a href="#custom-css-33"></a>  <span class="kw">display</span>: flex<span class="op">;</span></span>
<span id="custom-css-34"><a href="#custom-css-34"></a>  <span class="kw">margin-top</span>: <span class="dv">5</span><span class="dt">px</span><span class="op">;</span></span>
<span id="custom-css-35"><a href="#custom-css-35"></a>  <span class="kw">justify-content</span>: space-between<span class="op">;</span></span>
<span id="custom-css-36"><a href="#custom-css-36"></a>  <span class="kw">width</span>: <span class="dv">44</span><span class="dt">em</span><span class="op">;</span></span>
<span id="custom-css-37"><a href="#custom-css-37"></a>}</span>
<span id="custom-css-38"><a href="#custom-css-38"></a></span>
<span id="custom-css-39"><a href="#custom-css-39"></a><span class="im">@media</span> (<span class="kw">max-width</span>: <span class="dv">800</span><span class="dt">px</span>) {</span>
<span id="custom-css-40"><a href="#custom-css-40"></a>  <span class="fu">.resource</span> {</span>
<span id="custom-css-41"><a href="#custom-css-41"></a>    <span class="kw">width</span>: <span class="dv">100</span><span class="dt">%</span><span class="op">;</span></span>
<span id="custom-css-42"><a href="#custom-css-42"></a>  }</span>
<span id="custom-css-43"><a href="#custom-css-43"></a>}</span></code></pre></div>
<section id="sorting-filtering" class="level4">
<h4><span class="header-section-number">2.1.3.1</span> Sorting &amp; Filtering</h4>
<p>Since there’s quite a few articles it’s better to both filter and sort them but only if the user searches by title.</p>
<div class="sourceCode" id="resbrowser-view"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="resbrowser-view-1"><a href="#resbrowser-view-1"></a><span class="fu">filterAndSortBy</span> <span class="fu">order</span> <span class="op">=</span></span>
<span id="resbrowser-view-2"><a href="#resbrowser-view-2"></a>  <span class="cf">case</span> <span class="fu">order</span> <span class="cf">of</span></span>
<span id="resbrowser-view-3"><a href="#resbrowser-view-3"></a>    <span class="dt">Name</span> <span class="st">&quot;&quot;</span> <span class="op">-&gt;</span> []</span>
<span id="resbrowser-view-4"><a href="#resbrowser-view-4"></a>    <span class="dt">Name</span> <span class="fu">name</span> <span class="op">-&gt;</span> <span class="dt">List</span><span class="op">.</span><span class="fu">filter</span> (<span class="fu">byOrder</span> <span class="fu">order</span>) <span class="dt">Resources</span><span class="op">.</span><span class="fu">resources</span></span>
<span id="resbrowser-view-5"><a href="#resbrowser-view-5"></a>              <span class="op">|&gt;</span> <span class="dt">List</span><span class="op">.</span><span class="fu">sortWith</span> (<span class="fu">distance</span> <span class="fu">name</span>)</span>
<span id="resbrowser-view-6"><a href="#resbrowser-view-6"></a>    <span class="dt">TagName</span> <span class="fu">_</span> <span class="op">-&gt;</span> <span class="dt">List</span><span class="op">.</span><span class="fu">filter</span> (<span class="fu">byOrder</span> <span class="fu">order</span>) <span class="dt">Resources</span><span class="op">.</span><span class="fu">resources</span></span></code></pre></div>
<p>Filtering out any entries not containing the string brings the focus on a smaller set of results at the cost of being sensitive to typos.</p>
<div class="sourceCode" id="resbrowser-view"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="resbrowser-view-1"><a href="#resbrowser-view-1"></a><span class="fu">byOrder</span> <span class="fu">order</span> <span class="fu">r</span> <span class="op">=</span></span>
<span id="resbrowser-view-2"><a href="#resbrowser-view-2"></a>  <span class="cf">case</span> <span class="fu">order</span> <span class="cf">of</span></span>
<span id="resbrowser-view-3"><a href="#resbrowser-view-3"></a>    <span class="dt">Name</span> <span class="fu">name</span> <span class="op">-&gt;</span> <span class="dt">String</span><span class="op">.</span><span class="fu">contains</span> <span class="fu">name</span> (<span class="dt">String</span><span class="op">.</span><span class="fu">toLower</span> <span class="fu">r</span><span class="op">.</span><span class="fu">title</span>)</span>
<span id="resbrowser-view-4"><a href="#resbrowser-view-4"></a>    <span class="dt">TagName</span> <span class="fu">name</span> <span class="op">-&gt;</span> <span class="dt">List</span><span class="op">.</span><span class="fu">any</span> (\<span class="fu">x</span> <span class="op">-&gt;</span> <span class="fu">x</span> <span class="op">==</span> <span class="fu">name</span>) <span class="fu">r</span><span class="op">.</span><span class="fu">tags</span></span></code></pre></div>
<p>After filtering the results it would be good if they were sorted by the closest so far but we don’t really have enough to know what the search is for. Thus we guess by taking the distance between titles and the search string.</p>
<div class="sourceCode" id="resbrowser-view"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="resbrowser-view-1"><a href="#resbrowser-view-1"></a><span class="fu">distance</span> <span class="fu">from</span> <span class="kw">left</span> <span class="kw">right</span> <span class="op">=</span></span>
<span id="resbrowser-view-2"><a href="#resbrowser-view-2"></a>  <span class="kw">let</span></span>
<span id="resbrowser-view-3"><a href="#resbrowser-view-3"></a>    <span class="fu">index</span> <span class="fu">c</span> <span class="op">=</span></span>
<span id="resbrowser-view-4"><a href="#resbrowser-view-4"></a>      <span class="cf">case</span> <span class="dt">String</span><span class="op">.</span><span class="fu">indices</span> (<span class="dt">String</span><span class="op">.</span><span class="fu">fromChar</span> <span class="fu">c</span>) <span class="fu">from</span> <span class="cf">of</span></span>
<span id="resbrowser-view-5"><a href="#resbrowser-view-5"></a>        [] <span class="op">-&gt;</span> <span class="dv">0</span></span>
<span id="resbrowser-view-6"><a href="#resbrowser-view-6"></a>        <span class="fu">x</span> <span class="op">::</span> <span class="fu">xs</span> <span class="op">-&gt;</span> <span class="fu">x</span></span>
<span id="resbrowser-view-7"><a href="#resbrowser-view-7"></a>    <span class="fu">score</span> <span class="fu">c</span> <span class="fu">acc</span> <span class="op">=</span> <span class="fu">acc</span> <span class="op">+</span> <span class="fu">index</span> <span class="fu">c</span></span>
<span id="resbrowser-view-8"><a href="#resbrowser-view-8"></a>    <span class="fu">suml</span> <span class="op">=</span> <span class="dt">String</span><span class="op">.</span><span class="fu">foldl</span> <span class="fu">score</span> <span class="dv">0</span> <span class="kw">left</span><span class="op">.</span><span class="fu">title</span></span>
<span id="resbrowser-view-9"><a href="#resbrowser-view-9"></a>    <span class="fu">sumr</span> <span class="op">=</span> <span class="dt">String</span><span class="op">.</span><span class="fu">foldl</span> <span class="fu">score</span> <span class="dv">0</span> <span class="kw">right</span><span class="op">.</span><span class="fu">title</span></span>
<span id="resbrowser-view-10"><a href="#resbrowser-view-10"></a>  <span class="kw">in</span></span>
<span id="resbrowser-view-11"><a href="#resbrowser-view-11"></a>    <span class="fu">compare</span> <span class="fu">sumr</span> <span class="fu">suml</span></span></code></pre></div>
</section>
</section>
<section id="main" class="level3">
<h3><span class="header-section-number">2.1.4</span> Main</h3>
<p>Now imports you probably wanted at the start are relatively small except from <code>Resources</code> which isn’t shown in this document.</p>
<div class="sourceCode" id="resbrowser-main"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="resbrowser-main-1"><a href="#resbrowser-main-1"></a><span class="kw">import</span> <span class="dt">Html</span> <span class="kw">exposing</span> (<span class="op">..</span>)</span>
<span id="resbrowser-main-2"><a href="#resbrowser-main-2"></a><span class="kw">import</span> <span class="dt">Html</span><span class="op">.</span><span class="dt">Attributes</span> <span class="kw">exposing</span> (<span class="op">..</span>)</span>
<span id="resbrowser-main-3"><a href="#resbrowser-main-3"></a><span class="kw">import</span> <span class="dt">Html</span><span class="op">.</span><span class="dt">Events</span> <span class="kw">exposing</span> (<span class="fu">onClick</span><span class="op">,</span> <span class="fu">onInput</span>)</span>
<span id="resbrowser-main-4"><a href="#resbrowser-main-4"></a><span class="kw">import</span> <span class="dt">Browser</span></span>
<span id="resbrowser-main-5"><a href="#resbrowser-main-5"></a><span class="kw">import</span> <span class="dt">Resources</span> <span class="kw">exposing</span> (<span class="dt">Resource</span>)</span></code></pre></div>
<p>Main just packages up the three steps in a <code>Browser.sandbox</code>.</p>
<div class="sourceCode" id="resbrowser-main"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="resbrowser-main-1"><a href="#resbrowser-main-1"></a><span class="fu">main</span> <span class="op">=</span> <span class="dt">Browser</span><span class="op">.</span><span class="fu">sandbox</span></span>
<span id="resbrowser-main-2"><a href="#resbrowser-main-2"></a>  { <span class="fu">init</span> <span class="op">=</span> <span class="fu">init</span></span>
<span id="resbrowser-main-3"><a href="#resbrowser-main-3"></a>  <span class="op">,</span> <span class="fu">update</span> <span class="op">=</span> <span class="fu">update</span></span>
<span id="resbrowser-main-4"><a href="#resbrowser-main-4"></a>  <span class="op">,</span> <span class="fu">view</span> <span class="op">=</span> <span class="fu">view</span></span>
<span id="resbrowser-main-5"><a href="#resbrowser-main-5"></a>  }</span></code></pre></div>
<p>Finally to build the project we add it to the Makefile.</p>
<pre id="resource-browser-makefile" class="make"><code>RESBROWSER := projects/elm/resbrowser/src/ResourceBrowser.elm
scripts/resbrowser.js: ${RESBROWSER}
    cd ./projects/elm/resbrowser/ &amp;&amp; \
        elm make src/ResourceBrowser.elm \
            --optimize --output=../../../scripts/resbrowser.js</code></pre>
<p>And here it is! Try entering “category theory” or similar and watch the results roll-in.</p>
<div id="resbrowser">

</div>
<script src="scripts/resbrowser.js"></script>
<script>
var resbrowser = Elm.Main.init({
    node: document.getElementById("resbrowser")
});
</script>
</section>
</section>
</section>
<section id="zig-on-the-web" class="level1">
<h1><span class="header-section-number">3</span> Zig on the web</h1>
<p>Writing web applications is rather comfortable in elm but sometimes it’s nice to try something new and different. Zig is one language I’ve been interested in for a while and would like to get to know better as it supports<span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="sidenote">LLVM provides most of the work currently for cross-compilation of zig apart from the well designed standard library with it’s pass-the-allocator style allowing most of the library functions to work seamlessly other targets.<br />
<br />
</span></span> multiple platforms including freestanding which I’ve taken more of an interest in within the context of <a href="unikernel.org/projects">unikernels</a>. Back to the point, I like zig.</p>
<p>So why not try a web application? One of the targets is WebAssembly after all… and that is how this section came to be.</p>
<section id="build-script-for-webassembly" class="level2">
<h2><span class="header-section-number">3.1</span> Build script for WebAssembly</h2>
<p>First, the general structure of zig build scripts involves importing the <code>Builder</code> module which gives access to the various configuration objects used for setting compiler flags, dependencies, and so on.</p>
<pre id="zotw-imports" class="zig"><code>const Builder = @import(&quot;std&quot;).build.Builder;</code></pre>
<p>We’ll also need the <code>builtin</code> module since we’ll need to refer to WebAssembly directly as a compilation target rather than the default which is the current platform zig is compiling on.</p>
<pre id="zotw-imports" class="zig"><code>const builtin = @import(&quot;builtin&quot;);</code></pre>
<p>The structure of the build script itself is just the one function with the imports at the top<span><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="sidenote">Imports can be anywhere within a scope and need not be declared at the top of the file, however, it’s cleaner to declare them before use.<br />
<br />
</span></span> and <code>build</code> which takes a build context, configures it, then passes control back to zig’s build system.</p>
<pre class="zig" data-file="projects/zig/zig-on-the-web/build.zig"><code>&lt;&lt;zotw-imports&gt;&gt;
pub fn build(b: *Builder) void {
    &lt;&lt;zotw-configure-library-and-abi&gt;&gt;
    &lt;&lt;zotw-add-test-hook&gt;&gt;
}</code></pre>
<p>From the reference we get default mode as this application doesn’t have any fancy options and register it as a static library. This is important, registering this as an application won’t yield valid WebAssembly for use in the example as there’s no runtime and thus no logical entry-point.</p>
<pre id="zotw-configure-library" class="zig"><code>const mode = b.standardReleaseOptions();
const lib = b.addStaticLibrary(&quot;gamesvonkoch.github.io&quot;, &quot;src/web.zig&quot;);</code></pre>
<p>Then on to setting the configuration where the build mode is left to the default.</p>
<pre id="zotw-configure-library" class="zig"><code>lib.setBuildMode(mode);</code></pre>
<p>Then we declare the target to be <code>wasm32</code><span><label for="sn-3" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-3" class="margin-toggle"/><span class="sidenote">At the time of writing, most modern browsers only support wasm32 where wasm64 is experimental and thus needs to be enabled by the user in their browser configuration. This may be fine for playing with larger address ranges but in the case of building applications we can use now this is a bit impractical.<br />
<br />
</span></span> on a <code>freestanding</code> platform (no operating system) and with and ABI of <code>none</code> since we don’t need to conform to any call standard outside of our own.</p>
<pre id="zotw-configure-library" class="zig"><code>lib.setTarget(builtin.Arch.wasm32, builtin.Os.freestanding, builtin.Abi.none);
lib.install();</code></pre>
<p>Now building an application larger than a file or two without tests ends up being rather tedious so lets declare some.</p>
<p>Adding tests is pretty similar to registering the shared library with the exception of allowing us to run the code within test blocks directly.</p>
<pre id="zotw-add-test-hook" class="zig"><code>var main_tests = b.addTest(&quot;src/main.zig&quot;);
main_tests.setBuildMode(mode);</code></pre>
<p>Since <code>test</code> isn’t a command available to the builder by default we must add it ourselves by extending the builder with out own test depending on the step above. Of course tests are rather common in zig and thus we haven’t needed to write our own function for it as it’s taken care of above.</p>
<pre id="zotw-add-test-hook" class="zig"><code>const test_step = b.step(&quot;test&quot;, &quot;Run library tests&quot;);
test_step.dependOn(&amp;main_tests.step);</code></pre>
<p>And that concludes the build script for zig and WebAssembly.</p>
</section>
<section id="no-really-on-the-web" class="level2">
<h2><span class="header-section-number">3.2</span> No really, on the web</h2>
<p>So far we’ve only seen a build script with relatively little code and there isn’t so much here either. Now there’s a little more code involved in dealing with the browser. Some sadly has to be in javascript to interact with the outside world but the rest is all pure zig code.</p>
<pre class="zig" data-file="projects/zig/zig-on-the-web/src/app.zig"><code>const window = @import(&quot;window.zig&quot;);</code></pre>
<pre class="zig" data-file="projects/zig/zig-on-the-web/src/window.zig"><code>extern fn _alert(msg: [*]const u8, len: usize) void;

pub fn alert(msg: []u8) void {
  _alert(msg, msg.len);
}</code></pre>
<p>Boilerplate on the JavaScript side is minimal and consists of an entry-point to the application and text conversion. As we’ll see later on, this isn’t enough for</p>
<div class="sourceCode" id="cb7" data-file="projects/zig/zig-on-the-web/src/window.js"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">const</span> getString <span class="op">=</span> (p<span class="op">,</span> len) <span class="kw">=&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  (<span class="kw">new</span> <span class="at">TextDecoder</span>()).<span class="at">decode</span>(<span class="va">app</span>.<span class="va">exports</span>.<span class="va">memory</span>.<span class="va">buffer</span>.<span class="at">slice</span>(p<span class="op">,</span> p <span class="op">+</span> len))<span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="kw">var</span> app <span class="op">=</span> <span class="op">{</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="dt">imports</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>    <span class="dt">window</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>      <span class="dt">alert</span><span class="op">:</span> (p<span class="op">,</span> len) <span class="kw">=&gt;</span> <span class="at">alert</span>(<span class="at">getString</span>(p<span class="op">,</span> len))<span class="op">,</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>    <span class="op">},</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="op">},</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="dt">launch</span><span class="op">:</span> r <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>    <span class="va">app</span>.<span class="at">exports</span> <span class="op">=</span> <span class="va">r</span>.<span class="va">instance</span>.<span class="at">exports</span><span class="op">;</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="va">app</span>.<span class="va">exports</span>.<span class="at">launch</span>()) <span class="cf">throw</span> <span class="st">&quot;Launch Error&quot;</span><span class="op">;</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>  <span class="op">},</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>  <span class="dt">exports</span><span class="op">:</span> <span class="kw">undefined</span><span class="op">,</span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="op">};</span></span></code></pre></div>
<p>Finally getting something on the screen!</p>
<script>
</script>
<button onclick="zotw.exports.alert()">
Alert Zig
</button>
<!--
TODO:
- simple game (cat following a man over the elements of the page platformer)
- elara paper which bleeds into elara
- blend-in night section
-->
<div id="refs" class="references" role="doc-bibliography">
<div id="ref-catvh">
<p>[1] “All software sucks.”.</p>
</div>
</div>
</section>
</section>
</body>
</html>
