<html><head><meta charset="UTF-8"><link rel="stylesheet" href="../css/skeleton.css"/><link rel="stylesheet" href="../css/site.css"/><link href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Raleway:300,400&display=swap" rel="stylesheet"></head><body><h1 id="identity-entityframework">Identity &amp; EntityFramework</h1>
<div class="container">
<p><code>Identity</code> allows for integration with other services in terms of site membership management and automatic 0-Auth 2.0 while <code>EntityFramework</code> manages relations between items and interaction with an SQL database.</p>
<h2 id="school-database">School Database</h2>
<p>The school database assignment consists of implementing an application keeping track of students, teachers, courses, and assignments while allowing queries for each.</p>
<pre><code>teacher -&gt; [course]

student -&gt; [course]
student -&gt; [assignment]

assignment -&gt; course

course -&gt; [teacher]
course -&gt; [assignment]
course -&gt; [student]</code></pre>
<h3 id="implementation">Implementation</h3>
<div class="sourceCode" id="cb2" data-file="src/BackEnd/Models/SchoolDatabase.cs"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">using</span> Microsoft.<span class="fu">EntityFrameworkCore</span>;</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">namespace</span> BackEnd.<span class="fu">Models</span>.<span class="fu">SchoolDatabse</span></a>
<a class="sourceLine" id="cb2-5" title="5">{</a>
<a class="sourceLine" id="cb2-6" title="6">    &lt;&lt;person&gt;&gt;</a>
<a class="sourceLine" id="cb2-7" title="7">    &lt;&lt;teacher&gt;&gt;</a>
<a class="sourceLine" id="cb2-8" title="8">    &lt;&lt;student&gt;&gt;</a>
<a class="sourceLine" id="cb2-9" title="9">    &lt;&lt;assignment&gt;&gt;</a>
<a class="sourceLine" id="cb2-10" title="10">    &lt;&lt;course&gt;&gt;</a>
<a class="sourceLine" id="cb2-11" title="11"></a>
<a class="sourceLine" id="cb2-12" title="12">    &lt;&lt;many-to-many-relations&gt;&gt;</a>
<a class="sourceLine" id="cb2-13" title="13">    &lt;&lt;context&gt;&gt;</a>
<a class="sourceLine" id="cb2-14" title="14">}</a></code></pre></div>
<p>Database entries involving people derive from the following. A person is represented by a class <code>Person</code>.</p>
<div class="sourceCode" id="person"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="person-1" title="1"><span class="kw">public</span> <span class="kw">class</span> Person</a>
<a class="sourceLine" id="person-2" title="2">{</a></code></pre></div>
<p>Each <code>Person</code> comes with a unique identifier allowing us to distinguish between those with the same details and it represents on of the few static parts of an identity.</p>
<div class="sourceCode" id="person"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="person-1" title="1">    <span class="kw">public</span> <span class="dt">int</span> ID { <span class="kw">get</span>; <span class="kw">set</span>; }</a></code></pre></div>
<p>They also come with a <code>FirstName</code> and <code>LastName</code> which will be used in printed reports.</p>
<div class="sourceCode" id="person"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="person-1" title="1">    <span class="kw">public</span> <span class="dt">string</span> FirstName { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="person-2" title="2">    <span class="kw">public</span> <span class="dt">string</span> LastName { <span class="kw">get</span>; <span class="kw">set</span>; }</a></code></pre></div>
<p>Contact details are also stored in case one needs to contact the students.</p>
<div class="sourceCode" id="person"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="person-1" title="1">    <span class="kw">public</span> <span class="dt">string</span> Phone { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="person-2" title="2">    <span class="kw">public</span> <span class="dt">string</span> Email { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="person-3" title="3">}</a></code></pre></div>
<p>Teachers have no extra fields yet a better name tells a better story.</p>
<div class="sourceCode" id="teacher"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="teacher-1" title="1"><span class="kw">public</span> <span class="kw">class</span> Teacher : Person {}</a></code></pre></div>
<p>Students differ from teacher in that they also have assignments to keep track of.</p>
<div class="sourceCode" id="student"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="student-1" title="1"><span class="kw">public</span> <span class="kw">class</span> Student : Person</a>
<a class="sourceLine" id="student-2" title="2">{</a>
<a class="sourceLine" id="student-3" title="3">    <span class="kw">public</span> Assignment[] Assignments { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="student-4" title="4">}</a></code></pre></div>
<p>Assignments consist of an <code>ID</code> and a <code>Task</code> for the students to complete. Upon completion a student marks the specific assignment as <code>Complete</code>. Assignments are bound to a particular course in a <code>many-to-one</code> relation.</p>
<div class="sourceCode" id="assignment"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="assignment-1" title="1"><span class="kw">public</span> <span class="kw">class</span> Assignment</a>
<a class="sourceLine" id="assignment-2" title="2">{</a>
<a class="sourceLine" id="assignment-3" title="3">    <span class="kw">public</span> <span class="dt">int</span> ID { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="assignment-4" title="4">    <span class="kw">public</span> <span class="dt">bool</span> Complete { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="assignment-5" title="5">    <span class="kw">public</span> <span class="dt">string</span> Task { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="assignment-6" title="6">    <span class="kw">public</span> Course Origin { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="assignment-7" title="7">}</a></code></pre></div>
<p>Courses themselves keep track of the name, assignments, and <code>ID</code> where <code>Assignments</code> may be empty upon the creation of a new course.</p>
<div class="sourceCode" id="course"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="course-1" title="1"><span class="kw">public</span> <span class="kw">class</span> Course</a>
<a class="sourceLine" id="course-2" title="2">{</a>
<a class="sourceLine" id="course-3" title="3">    <span class="kw">public</span> <span class="dt">int</span> ID { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="course-4" title="4">    <span class="kw">public</span> <span class="dt">string</span> Name { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="course-5" title="5">    <span class="kw">public</span> Assignment[] Assignments { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="course-6" title="6">}</a></code></pre></div>
<p>Itâ€™s possible for a course to have multiple teachers while teachers can have multiple courses.</p>
<div class="sourceCode" id="many-to-many-relations"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="many-to-many-relations-1" title="1"><span class="kw">public</span> <span class="kw">class</span> TeacherCourse</a>
<a class="sourceLine" id="many-to-many-relations-2" title="2">{</a>
<a class="sourceLine" id="many-to-many-relations-3" title="3">    <span class="kw">public</span> <span class="dt">int</span> TeacherID;</a>
<a class="sourceLine" id="many-to-many-relations-4" title="4">    <span class="kw">public</span> <span class="dt">int</span> CourseID;</a>
<a class="sourceLine" id="many-to-many-relations-5" title="5">}</a></code></pre></div>
<p>The <code>many-to-many</code> relation is also true for students which may have many courses and courses have many students.</p>
<div class="sourceCode" id="many-to-many-relations"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="many-to-many-relations-1" title="1"><span class="kw">public</span> <span class="kw">class</span> StudentCourse</a>
<a class="sourceLine" id="many-to-many-relations-2" title="2">{</a>
<a class="sourceLine" id="many-to-many-relations-3" title="3">    <span class="kw">public</span> <span class="dt">int</span> StudentID;</a>
<a class="sourceLine" id="many-to-many-relations-4" title="4">    <span class="kw">public</span> <span class="dt">int</span> CourseID;</a>
<a class="sourceLine" id="many-to-many-relations-5" title="5">}</a></code></pre></div>
<p>Finally, the database <code>Context</code> contains the description of the database we wish to construct.</p>
<div class="sourceCode" id="context"><pre class="sourceCode cs"><code class="sourceCode cs"><a class="sourceLine" id="context-1" title="1"><span class="kw">public</span> <span class="kw">class</span> Context : DbContext</a>
<a class="sourceLine" id="context-2" title="2">{</a>
<a class="sourceLine" id="context-3" title="3">    <span class="kw">public</span> DbSet&lt;Student&gt; Students { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="context-4" title="4">    <span class="kw">public</span> DbSet&lt;Teacher&gt; Teachers { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="context-5" title="5">    <span class="kw">public</span> DbSet&lt;Assignment&gt; Assignments { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="context-6" title="6">    <span class="kw">public</span> DbSet&lt;Course&gt; Courses { <span class="kw">get</span>; <span class="kw">set</span>; }</a>
<a class="sourceLine" id="context-7" title="7">}</a></code></pre></div>
<h3 id="controller">Controller</h3>
<div class="sourceCode" id="cb3" data-file="src/BackEnd/Controllers/SchoolDatabase.cs"><pre class="sourceCode cs"><code class="sourceCode cs"></code></pre></div>
<h3 id="views">Views</h3>
<p>The primary view displays the first few entries along with possible actions for each.</p>
<pre class="cshtml" data-file="src/BackEnd/Views/SchoolDatabase/Index.cshtml"><code>@ViewData[&quot;Title&quot;] = &quot;School Database&quot;;</code></pre>
<p>Searching results in an expanded view of all records matching with pagination.</p>
<pre class="cshtml" data-file="src/BackEnd/Views/SchoolDatabase/Search.cshtml"><code>@ViewData[&quot;Title&quot;] = &quot;Search&quot;;
&lt;input type=&quot;text&quot; /&gt;</code></pre>
<p>New entries can be created.</p>
<pre class="cshtml" data-file="src/BackEnd/Views/SchoolDatabase/NewEntry.cshtml"><code>@ViewData[&quot;Title&quot;] = &quot;Add New Entry&quot;;
@if (ViewData[&quot;AddType&quot;] != null)
{
    switch((string)ViewData[&quot;AddType&quot;])
    {
        case &quot;course&quot;:
            &lt;form&gt;
                Course Name: &lt;input type=&quot;text&quot; /&gt;
                &lt;input type=&quot;submit&quot; /&gt;
            &lt;/form&gt;
            break;
        case &quot;assignment&quot;:
            &lt;form&gt;
                Assignment Title: &lt;input type=&quot;text&quot; /&gt;
                Assignment: &lt;textarea name=&quot;text&quot;&gt;&lt;/textarea&gt;
                &lt;input type=&quot;submit&quot; /&gt;
            &lt;/form&gt;
            break;
        case &quot;teacher&quot;:
        case &quot;student&quot;:
            &lt;form&gt;
                Name: &lt;input type=&quot;text&quot; /&gt;
                Last: &lt;input type=&quot;text&quot; /&gt;
                Phone: &lt;input type=&quot;text&quot; /&gt;
                Email: &lt;input type=&quot;email&quot; /&gt;
                &lt;input type=&quot;submit&quot; /&gt;
            &lt;/form&gt;
            break;
        default:
            break;
    }
}
else
{
    &lt;button value=&quot;course&quot;&gt;Add new course&lt;/button&gt;
    &lt;button value=&quot;teacher&quot;&gt;Add new teacher&lt;/button&gt;
    &lt;button value=&quot;student&quot;&gt;Add new student&lt;/button&gt;
    &lt;button value=&quot;assignmnet&quot;&gt;Add new assignment&lt;/button&gt;
}</code></pre>
<p>Entries can be modified after creation.</p>
<pre class="cshtml" data-file="src/BackEnd/Views/SchoolDatabase/Edit.cshtml"><code>@ViewData[&quot;Title&quot;] = &quot;Edit -&quot; + (string)@ViewData[&quot;PersonType&quot;];</code></pre>
</div>
<footer>Copyright (c) 2019 Simon A. Nielsen Knights</footer></body></html>